<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Admin Pelatihan</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDyx3hfM_49dQPWrYeKBuZ_5umRPGvTjLI",
      authDomain: "greciaexperiment.firebaseapp.com",
      projectId: "greciaexperiment",
      storageBucket: "greciaexperiment.appspot.com",
      messagingSenderId: "449936532510",
      appId: "1:449936532510:web:9186754bceb92884c63a0f",
      measurementId: "G-5R08SBGN4N"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    document.addEventListener("DOMContentLoaded", async () => {
      // load data setting
      const docRef = doc(db, "setting_acara", "rabu_malam");
      const snap = await getDoc(docRef);
      if (snap.exists()) {
        const d = snap.data();
        document.getElementById("zoom").value = d.zoom_link;
        document.getElementById("youtube").value = d.youtube_link;
        document.getElementById("jadwal").value = d.jadwal_mulai;
        document.getElementById("durasi").value = d.durasi_menit;
      }

      // tampilkan absen
      const absRef = collection(db, "absensi");
      const snaps = await getDocs(absRef);
      const list = document.getElementById("absenList");
      snaps.forEach(doc => {
        const d = doc.data();
        const li = document.createElement("li");
        li.textContent = `${d.nama} - ${new Date(d.waktu_absen).toLocaleString("id-ID")}`;
        list.appendChild(li);
      });
    });

    async function simpanSetting() {
      const zoom = document.getElementById("zoom").value;
      const youtube = document.getElementById("youtube").value;
      const jadwal = document.getElementById("jadwal").value;
      const durasi = parseInt(document.getElementById("durasi").value);

      await setDoc(doc(db, "setting_acara", "rabu_malam"), {
        zoom_link: zoom,
        youtube_link: youtube,
        jadwal_mulai: jadwal,
        durasi_menit: durasi
      });

      alert("Setting acara berhasil disimpan!");
    }

    window.simpanSetting = simpanSetting;
  </script>
</head>
<body>
  <h2>Admin Panel</h2>
  <h3>Atur Link Acara</h3>
  <input id="zoom" placeholder="Link Zoom"><br>
  <input id="youtube" placeholder="Link YouTube"><br>
  <input id="jadwal" type="datetime-local"><br>
  <input id="durasi" type="number" placeholder="Durasi menit"><br>
  <button onclick="simpanSetting()">Simpan</button>

  <h3>Data Absensi</h3>
  <ul id="absenList"></ul>
</body>
</html>
